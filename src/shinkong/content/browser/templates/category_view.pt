<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:v-on="http://vuejs.org"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="gct.content">
<body>
<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
<style>
.childContainer{
    margin: 10px 0;
}
.content h3{
    color: blue;
}
</style>

Denier 
<select id="denier">
    <option value="">----請選擇----</option>
</select>

<div style="display: none" id='optionContainer'>
    Filament
    <select name="" id="filament" >
    </select>
<br>
    High Tenacity<input type='number' min='0' id='high_tenacity' step='0.1' >

    Elongation<input type='number' min='0' id='elongation' >

    H.A.S(2)<input type='number' min='0' id='has2' step='0.1' >
</div>

<button id='search_btn'>Search</button>

<br>

<div id="left_side" class='col-md-3'>
    <h3>應用產品</h3>
    <tal:repeat repeat="item view/application">
        <a tal:define="obj python: item.getObject()" style='display: block; border: none'
           href="${python: obj.absolute_url()}">${item/Title}</a>
    </tal:repeat>
</div>

<div id='result' class='col-md-9'>
    <img src="${view/context/absolute_url}/@@images/image/preview" alt="">
    <h2>${view/context/Title}</h2>
    <h4>${view/context/description}</h4>
    
    <div class="col-md-12">
        <div class="row">
            <div tal:repeat="child view/context/getChildNodes" class='childContainer col-md-12'>
                <img src="${child/absolute_url}/@@images/image/mini" class='col-md-4'>
                <div class="col-md-8 content">
                    <h3>${child/Title}</h3>
                    <p>${child/description}</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
$(function(){

    $('#content header').hide()
    Object.keys(${view/denierDict}).forEach(function(e){
        $('#denier').append("<option value=" + e + ">" + e + "</option>");
    })

    $('#denier').change(function () {
        denierDict = ${view/denierDict}
        val = $(this).val()
        if(denierDict[val]){
            $('#optionContainer').show();
            $('#filament').html("");
            denierDict[val].forEach(e => {
                $('#filament').append("<option value=" + e + ">" + e + "</option>");
            });
        }else{
            $('#optionContainer').hide();
        }
        // val = $(this).val()
        // data = {
        //     'denier': val
        // }
        // url = '${portal_url}/@@search_product_result'
        // $.ajax({
        //     type: "post",
        //     url: url,
        //     data: data,
        //     success: function (rep) {
        //         debugger

        //         data = JSON.parse(rep)
        //         if(data.length != 0){
        //             $('#optionContainer').show();
        //             $('#filament').html("");
        //             data.forEach(e => {
        //                 $('#filament').append("<option value=" + e + ">" + e + "</option>");
        //             });
        //         }else{
        //             $('#optionContainer').hide();
        //             $('#result').html("查無資料");
        //         }
        //     }
        // });
    });
    $('#search_btn').click(function(){
        denier = $("#denier").val();
        select_type = $('#select_type').val()
        high_tenacity = $('#high_tenacity').val()
        elongation = $('#elongation').val()
        has2 = $('#has2').val()
        filament = $("#filament").val()

        count = 0
        if(!denier){
            alert('請選擇丹寧數')
            return 
        }
        if(high_tenacity){
            count += 1
        }
        if(elongation){
            count += 1
        }
        if(has2){
            count += 1
        }
        if(count == 0){
            alert('high_tenacity,elongation,has2請至少填寫一個')
            return
        }

        data = {
            'filament': filament,
            'select_type': select_type,
            'high_tenacity': high_tenacity,
            'elongation': elongation,
            'has2': has2,
            'denier': denier
        }
        url = '${portal_url}/@@search_product_result'
        $.ajax({
            type: "post",
            url: url,
            data: data,
            success: function (rep) {
                debugger
                $('#result').html(rep)
            }
        });    
    })
})
</script>

</metal:content-core>
</metal:content-core>

</body>
</html>

